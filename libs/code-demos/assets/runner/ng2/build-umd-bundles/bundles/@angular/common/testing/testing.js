!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("rxjs")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ngCommonTesting={},t.ngCore,t.ngCommon,t.rxjs)}(this,(function(t,e,s,h){"use strict";function r(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(s){if("default"!==s){var h=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,h.get?h:{enumerable:!0,get:function(){return t[s]}})}})),e.default=t,Object.freeze(e)}var n=r(e);function a(t){return t&&"?"!==t[0]?"?"+t:t}class i{constructor(){this.urlChanges=[],this._history=[new o("","",null)],this._historyIndex=0,this._subject=new e.EventEmitter,this._basePath="",this._locationStrategy=null,this._urlChangeListeners=[],this._urlChangeSubscription=null}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}setInitialPath(t){this._history[this._historyIndex].path=t}setBaseHref(t){this._basePath=t}path(){return this._history[this._historyIndex].path}getState(){return this._history[this._historyIndex].state}isCurrentPathEqualTo(t,e=""){const s=t.endsWith("/")?t.substring(0,t.length-1):t;return(this.path().endsWith("/")?this.path().substring(0,this.path().length-1):this.path())==s+(e.length>0?"?"+e:"")}simulateUrlPop(t){this._subject.emit({url:t,pop:!0,type:"popstate"})}simulateHashChange(t){const e=this.prepareExternalUrl(t);this.pushHistory(e,"",null),this.urlChanges.push("hash: "+t),this._subject.emit({url:t,pop:!0,type:"popstate"}),this._subject.emit({url:t,pop:!0,type:"hashchange"})}prepareExternalUrl(t){return t.length>0&&!t.startsWith("/")&&(t="/"+t),this._basePath+t}go(t,e="",s=null){t=this.prepareExternalUrl(t),this.pushHistory(t,e,s);const h=this._history[this._historyIndex-1];if(h.path==t&&h.query==e)return;const r=t+(e.length>0?"?"+e:"");this.urlChanges.push(r),this._notifyUrlChangeListeners(t+a(e),s)}replaceState(t,e="",s=null){t=this.prepareExternalUrl(t);const h=this._history[this._historyIndex];if(h.state=s,h.path==t&&h.query==e)return;h.path=t,h.query=e;const r=t+(e.length>0?"?"+e:"");this.urlChanges.push("replace: "+r),this._notifyUrlChangeListeners(t+a(e),s)}forward(){this._historyIndex<this._history.length-1&&(this._historyIndex++,this._subject.emit({url:this.path(),state:this.getState(),pop:!0,type:"popstate"}))}back(){this._historyIndex>0&&(this._historyIndex--,this._subject.emit({url:this.path(),state:this.getState(),pop:!0,type:"popstate"}))}historyGo(t=0){const e=this._historyIndex+t;e>=0&&e<this._history.length&&(this._historyIndex=e,this._subject.emit({url:this.path(),state:this.getState(),pop:!0,type:"popstate"}))}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe((t=>{this._notifyUrlChangeListeners(t.url,t.state)}))),()=>{const e=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(e,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",e){this._urlChangeListeners.forEach((s=>s(t,e)))}subscribe(t,e,s){return this._subject.subscribe({next:t,error:e,complete:s})}normalize(t){return null}pushHistory(t,e,s){this._historyIndex>0&&this._history.splice(this._historyIndex+1),this._history.push(new o(t,e,s)),this._historyIndex=this._history.length-1}}i.ɵfac=n.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"15.0.4",ngImport:n,type:i,deps:[],target:n.ɵɵFactoryTarget.Injectable}),i.ɵprov=n.ɵɵngDeclareInjectable({minVersion:"12.0.0",version:"15.0.4",ngImport:n,type:i}),n.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"15.0.4",ngImport:n,type:i,decorators:[{type:e.Injectable}]});class o{constructor(t,e,s){this.path=t,this.query=e,this.state=s}}class l extends s.LocationStrategy{constructor(){super(),this.internalBaseHref="/",this.internalPath="/",this.internalTitle="",this.urlChanges=[],this._subject=new e.EventEmitter,this.stateChanges=[]}simulatePopState(t){this.internalPath=t,this._subject.emit(new u(this.path()))}path(t=!1){return this.internalPath}prepareExternalUrl(t){return t.startsWith("/")&&this.internalBaseHref.endsWith("/")?this.internalBaseHref+t.substring(1):this.internalBaseHref+t}pushState(t,e,s,h){this.stateChanges.push(t),this.internalTitle=e;const r=s+(h.length>0?"?"+h:"");this.internalPath=r;const n=this.prepareExternalUrl(r);this.urlChanges.push(n)}replaceState(t,e,s,h){this.stateChanges[(this.stateChanges.length||1)-1]=t,this.internalTitle=e;const r=s+(h.length>0?"?"+h:"");this.internalPath=r;const n=this.prepareExternalUrl(r);this.urlChanges.push("replace: "+n)}onPopState(t){this._subject.subscribe({next:t})}getBaseHref(){return this.internalBaseHref}back(){if(this.urlChanges.length>0){this.urlChanges.pop(),this.stateChanges.pop();const t=this.urlChanges.length>0?this.urlChanges[this.urlChanges.length-1]:"";this.simulatePopState(t)}}forward(){throw"not implemented"}getState(){return this.stateChanges[(this.stateChanges.length||1)-1]}}l.ɵfac=n.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"15.0.4",ngImport:n,type:l,deps:[],target:n.ɵɵFactoryTarget.Injectable}),l.ɵprov=n.ɵɵngDeclareInjectable({minVersion:"12.0.0",version:"15.0.4",ngImport:n,type:l}),n.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"15.0.4",ngImport:n,type:l,decorators:[{type:e.Injectable}],ctorParameters:function(){return[]}});class u{constructor(t){this.newUrl=t,this.pop=!0,this.type="popstate"}}const p=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;function c(t,e){let s,h;/^((http[s]?|ftp):\/\/)/.test(t)||(s="http://empty.com/");try{h=new URL(t,s)}catch(r){const n=p.exec(s||""+t);if(!n)throw new Error(`Invalid URL: ${t} with base: ${e}`);const a=n[4].split(":");h={protocol:n[1],hostname:a[0],port:a[1]||"",pathname:n[5],search:n[6],hash:n[8]}}return h.pathname&&0===h.pathname.indexOf(e)&&(h.pathname=h.pathname.substring(e.length)),{hostname:!s&&h.hostname||"",protocol:!s&&h.protocol||"",port:!s&&h.port||"",pathname:h.pathname||"/",search:h.search||"",hash:h.hash||""}}const g=new e.InjectionToken("MOCK_PLATFORM_LOCATION_CONFIG");class C{constructor(t){if(this.baseHref="",this.hashUpdate=new h.Subject,this.popStateSubject=new h.Subject,this.urlChangeIndex=0,this.urlChanges=[{hostname:"",protocol:"",port:"",pathname:"/",search:"",hash:"",state:null}],t){this.baseHref=t.appBaseHref||"";const e=this.parseChanges(null,t.startUrl||"http://_empty_/",this.baseHref);this.urlChanges[0]={...e}}}get hostname(){return this.urlChanges[this.urlChangeIndex].hostname}get protocol(){return this.urlChanges[this.urlChangeIndex].protocol}get port(){return this.urlChanges[this.urlChangeIndex].port}get pathname(){return this.urlChanges[this.urlChangeIndex].pathname}get search(){return this.urlChanges[this.urlChangeIndex].search}get hash(){return this.urlChanges[this.urlChangeIndex].hash}get state(){return this.urlChanges[this.urlChangeIndex].state}getBaseHrefFromDOM(){return this.baseHref}onPopState(t){const e=this.popStateSubject.subscribe(t);return()=>e.unsubscribe()}onHashChange(t){const e=this.hashUpdate.subscribe(t);return()=>e.unsubscribe()}get href(){let t=`${this.protocol}//${this.hostname}${this.port?":"+this.port:""}`;return t+=`${"/"===this.pathname?"":this.pathname}${this.search}${this.hash}`,t}get url(){return`${this.pathname}${this.search}${this.hash}`}parseChanges(t,e,s=""){return t=JSON.parse(JSON.stringify(t)),{...c(e,s),state:t}}replaceState(t,e,s){const{pathname:h,search:r,state:n,hash:a}=this.parseChanges(t,s);this.urlChanges[this.urlChangeIndex]={...this.urlChanges[this.urlChangeIndex],pathname:h,search:r,hash:a,state:n}}pushState(t,e,s){const{pathname:h,search:r,state:n,hash:a}=this.parseChanges(t,s);this.urlChangeIndex>0&&this.urlChanges.splice(this.urlChangeIndex+1),this.urlChanges.push({...this.urlChanges[this.urlChangeIndex],pathname:h,search:r,hash:a,state:n}),this.urlChangeIndex=this.urlChanges.length-1}forward(){const t=this.url,e=this.hash;this.urlChangeIndex<this.urlChanges.length&&this.urlChangeIndex++,this.emitEvents(e,t)}back(){const t=this.url,e=this.hash;this.urlChangeIndex>0&&this.urlChangeIndex--,this.emitEvents(e,t)}historyGo(t=0){const e=this.url,s=this.hash,h=this.urlChangeIndex+t;h>=0&&h<this.urlChanges.length&&(this.urlChangeIndex=h),this.emitEvents(s,e)}getState(){return this.state}emitEvents(t,e){this.popStateSubject.next({type:"popstate",state:this.getState(),oldUrl:e,newUrl:this.url}),t!==this.hash&&this.hashUpdate.next({type:"hashchange",state:null,oldUrl:e,newUrl:this.url})}}C.ɵfac=n.ɵɵngDeclareFactory({minVersion:"12.0.0",version:"15.0.4",ngImport:n,type:C,deps:[{token:g,optional:!0}],target:n.ɵɵFactoryTarget.Injectable}),C.ɵprov=n.ɵɵngDeclareInjectable({minVersion:"12.0.0",version:"15.0.4",ngImport:n,type:C}),n.ɵɵngDeclareClassMetadata({minVersion:"12.0.0",version:"15.0.4",ngImport:n,type:C,decorators:[{type:e.Injectable}],ctorParameters:function(){return[{type:void 0,decorators:[{type:e.Inject,args:[g]},{type:e.Optional}]}]}}),t.MOCK_PLATFORM_LOCATION_CONFIG=g,t.MockLocationStrategy=l,t.MockPlatformLocation=C,t.SpyLocation=i,t.provideLocationMocks=function(){return[{provide:s.Location,useClass:i},{provide:s.LocationStrategy,useClass:l}]}}));
