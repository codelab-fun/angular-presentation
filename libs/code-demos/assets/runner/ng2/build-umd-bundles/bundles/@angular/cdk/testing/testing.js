!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ngCdkTesting={},t.rxjs)}(this,(function(t,e){"use strict";const n=new e.BehaviorSubject({isDisabled:!1});let r;function s(t){t.onDetectChangesNow?.()}function o(t){a(),r=n.subscribe(t)}function a(){r?.unsubscribe(),r=null}async function i(t,e){if(n.getValue().isDisabled)return await t();if(r||o(s),e){await new Promise((t=>n.next({isDisabled:!0,onDetectChangesNow:t})));try{return await t()}finally{await new Promise((t=>n.next({isDisabled:!1,onDetectChangesNow:t})))}}else{n.next({isDisabled:!0});try{return await t()}finally{n.next({isDisabled:!1})}}}async function l(t){return i((()=>Promise.all(t())),!0)}class c{constructor(t){this.locatorFactory=t}async host(){return this.locatorFactory.rootElement}documentRootLocatorFactory(){return this.locatorFactory.documentRootLocatorFactory()}locatorFor(...t){return this.locatorFactory.locatorFor(...t)}locatorForOptional(...t){return this.locatorFactory.locatorForOptional(...t)}locatorForAll(...t){return this.locatorFactory.locatorForAll(...t)}async forceStabilize(){return this.locatorFactory.forceStabilize()}async waitForTasksOutsideAngular(){return this.locatorFactory.waitForTasksOutsideAngular()}}class u{constructor(t,e){this.harnessType=t,this._predicates=[],this._descriptions=[],this._addBaseOptions(e)}static async stringMatches(t,e){return t=await t,null===e?null===t:null!==t&&("string"==typeof e?t===e:e.test(t))}add(t,e){return this._descriptions.push(t),this._predicates.push(e),this}addOption(t,e,n){return void 0!==e&&this.add(`${t} = ${function(t){if(void 0===t)return"undefined";try{return JSON.stringify(t,((t,e)=>e instanceof RegExp?`◬MAT_RE_ESCAPE◬${e.toString().replace(/"/g,"◬MAT_RE_ESCAPE◬")}◬MAT_RE_ESCAPE◬`:e)).replace(/"◬MAT_RE_ESCAPE◬|◬MAT_RE_ESCAPE◬"/g,"").replace(/◬MAT_RE_ESCAPE◬/g,'"')}catch{return"{...}"}}(e)}`,(t=>n(t,e))),this}async filter(t){if(0===t.length)return[];const e=await l((()=>t.map((t=>this.evaluate(t)))));return t.filter(((t,n)=>e[n]))}async evaluate(t){return(await l((()=>this._predicates.map((e=>e(t)))))).reduce(((t,e)=>t&&e),!0)}getDescription(){return this._descriptions.join(", ")}getSelector(){if(!this._ancestor)return(this.harnessType.hostSelector||"").trim();const[t,e]=h(this._ancestor),[n,r]=h(this.harnessType.hostSelector||""),s=[];return t.forEach((t=>{const o=d(t,e);return n.forEach((t=>s.push(`${o} ${d(t,r)}`)))})),s.join(", ")}_addBaseOptions(t){this._ancestor=t.ancestor||"",this._ancestor&&this._descriptions.push(`has ancestor matching selector "${this._ancestor}"`);const e=t.selector;void 0!==e&&this.add(`host matches selector "${e}"`,(async t=>(await t.host()).matchesSelector(e)))}}function h(t){const e=[];return[t.replace(/(["'][^["']*["'])/g,((t,n)=>{const r=`__cdkPlaceholder-${e.length}__`;return e.push(n),r})).split(",").map((t=>t.trim())),e]}function d(t,e){return t.replace(/__cdkPlaceholder-(\d+)__/g,((t,n)=>e[+n]))}async function E(t,e){const n=(await t)[0];if(null==n)throw Error("Failed to find element matching one of the following queries:\n"+e.map((t=>`(${t})`)).join(",\n"));return n}function g(t){return`HarnessLoader for element matching selector: "${t}"`}var m;t.TestKey=void 0,(m=t.TestKey||(t.TestKey={}))[m.BACKSPACE=0]="BACKSPACE",m[m.TAB=1]="TAB",m[m.ENTER=2]="ENTER",m[m.SHIFT=3]="SHIFT",m[m.CONTROL=4]="CONTROL",m[m.ALT=5]="ALT",m[m.ESCAPE=6]="ESCAPE",m[m.PAGE_UP=7]="PAGE_UP",m[m.PAGE_DOWN=8]="PAGE_DOWN",m[m.END=9]="END",m[m.HOME=10]="HOME",m[m.LEFT_ARROW=11]="LEFT_ARROW",m[m.UP_ARROW=12]="UP_ARROW",m[m.RIGHT_ARROW=13]="RIGHT_ARROW",m[m.DOWN_ARROW=14]="DOWN_ARROW",m[m.INSERT=15]="INSERT",m[m.DELETE=16]="DELETE",m[m.F1=17]="F1",m[m.F2=18]="F2",m[m.F3=19]="F3",m[m.F4=20]="F4",m[m.F5=21]="F5",m[m.F6=22]="F6",m[m.F7=23]="F7",m[m.F8=24]="F8",m[m.F9=25]="F9",m[m.F10=26]="F10",m[m.F11=27]="F11",m[m.F12=28]="F12",m[m.META=29]="META",t.ComponentHarness=c,t.ContentContainerComponentHarness=class extends c{async getChildLoader(t){return(await this.getRootHarnessLoader()).getChildLoader(t)}async getAllChildLoaders(t){return(await this.getRootHarnessLoader()).getAllChildLoaders(t)}async getHarness(t){return(await this.getRootHarnessLoader()).getHarness(t)}async getHarnessOrNull(t){return(await this.getRootHarnessLoader()).getHarnessOrNull(t)}async getAllHarnesses(t){return(await this.getRootHarnessLoader()).getAllHarnesses(t)}async hasHarness(t){return(await this.getRootHarnessLoader()).hasHarness(t)}async getRootHarnessLoader(){return this.locatorFactory.rootHarnessLoader()}},t.HarnessEnvironment=class{constructor(t){this.rawRootElement=t}get rootElement(){return this._rootElement=this._rootElement||this.createTestElement(this.rawRootElement),this._rootElement}set rootElement(t){this._rootElement=t}documentRootLocatorFactory(){return this.createEnvironment(this.getDocumentRoot())}locatorFor(...t){return()=>E(this._getAllHarnessesAndTestElements(t),function(t){return t.map((t=>"string"==typeof t?`TestElement for element matching selector: "${t}"`:function(t){const e=t instanceof u?t:new u(t,{}),{name:n,hostSelector:r}=e.harnessType,s=`${n} with host element matching selector: "${r}"`,o=e.getDescription();return s+(o?` satisfying the constraints: ${e.getDescription()}`:"")}(t)))}(t))}locatorForOptional(...t){return async()=>(await this._getAllHarnessesAndTestElements(t))[0]||null}locatorForAll(...t){return()=>this._getAllHarnessesAndTestElements(t)}async rootHarnessLoader(){return this}async harnessLoaderFor(t){return this.createEnvironment(await E(this.getAllRawElements(t),[g(t)]))}async harnessLoaderForOptional(t){const e=await this.getAllRawElements(t);return e[0]?this.createEnvironment(e[0]):null}async harnessLoaderForAll(t){return(await this.getAllRawElements(t)).map((t=>this.createEnvironment(t)))}getHarness(t){return this.locatorFor(t)()}getHarnessOrNull(t){return this.locatorForOptional(t)()}getAllHarnesses(t){return this.locatorForAll(t)()}async hasHarness(t){return null!==await this.locatorForOptional(t)()}async getChildLoader(t){return this.createEnvironment(await E(this.getAllRawElements(t),[g(t)]))}async getAllChildLoaders(t){return(await this.getAllRawElements(t)).map((t=>this.createEnvironment(t)))}createComponentHarness(t,e){return new t(this.createEnvironment(e))}async _getAllHarnessesAndTestElements(t){if(!t.length)throw Error("CDK Component harness query must contain at least one element.");const{allQueries:e,harnessQueries:n,elementQueries:r,harnessTypes:s}=function(t){const e=[],n=[],r=[],s=new Set;for(const o of t)if("string"==typeof o)e.push(o),r.push(o);else{const t=o instanceof u?o:new u(o,{});e.push(t),n.push(t),s.add(t.harnessType)}return{allQueries:e,harnessQueries:n,elementQueries:r,harnessTypes:s}}(t),o=await this.getAllRawElements([...r,...n.map((t=>t.getSelector()))].join(",")),a=0===r.length&&1===s.size||0===n.length,i=await l((()=>o.map((async t=>{const n=this.createTestElement(t);return async function(t){let e=!1,n=new Set;const r=[];for(const s of t)s&&(s instanceof c?n.has(s.constructor)||(n.add(s.constructor),r.push(s)):e||(e=!0,r.push(s)));return r}(await l((()=>e.map((e=>this._getQueryResultForElement(e,t,n,a))))))}))));return[].concat(...i)}async _getQueryResultForElement(t,e,n,r=!1){if("string"==typeof t)return r||await n.matchesSelector(t)?n:null;if(r||await n.matchesSelector(t.getSelector())){const n=this.createComponentHarness(t.harnessType,e);return await t.evaluate(n)?n:null}return null}},t.HarnessPredicate=u,t._getTextWithExcludedElements=function(t,e){const n=t.cloneNode(!0),r=n.querySelectorAll(e);for(let t=0;t<r.length;t++)r[t].remove();return(n.textContent||"").trim()},t.getNoKeysSpecifiedError=function(){return Error("No keys have been specified.")},t.handleAutoChangeDetectionStatus=o,t.manualChangeDetection=async function(t){return i(t,!1)},t.parallel=l,t.stopHandlingAutoChangeDetectionStatus=a}));
